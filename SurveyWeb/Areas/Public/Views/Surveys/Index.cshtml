@model IEnumerable<SurveyWeb.Models.Survey>
@{
    Layout = "~/Areas/Public/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Tất cả khảo sát";
    var now = DateTime.UtcNow;

    bool IsActive(SurveyWeb.Models.Survey survey)
    {
        if (!string.Equals(survey.StatusCode, "active", StringComparison.OrdinalIgnoreCase))
            return false;
        if (survey.StartAt.HasValue && survey.StartAt.Value > now) return false;
        if (survey.EndAt.HasValue && survey.EndAt.Value < now) return false;
        return true;
    }

    string StatusText(SurveyWeb.Models.Survey survey) => IsActive(survey) ? "Đang mở" : "Tạm dừng";
}

<!-- ==== STYLE: chỉ áp dụng cho view này ==== -->
<style>
:root{ --c-primary:#4f46e5; --c-primary-2:#7c3aed; --c-muted:#64748b; }

.section-hero{
  border-radius: 24px;
  background:
    radial-gradient(70% 120% at 100% 0%, rgba(124,58,237,.12), transparent 60%),
    radial-gradient(60% 120% at 0% 100%, rgba(79,70,229,.12), transparent 60%),
    linear-gradient(180deg, #ffffff, #f8fafc);
  border: 1px solid rgba(2,6,23,.06);
  box-shadow: 0 30px 60px -30px rgba(2,6,23,.20);
}

.title-gradient{
  background: linear-gradient(90deg,var(--c-primary),var(--c-primary-2));
  -webkit-background-clip:text; background-clip:text; color:transparent;
}

/* Card */
.card-smooth{ border-radius: 18px; overflow: hidden; border:0; box-shadow: 0 10px 24px -18px rgba(2,6,23,.35); transition: transform .18s ease, box-shadow .18s ease; }
.card-smooth:hover{ transform: translateY(-4px); box-shadow: 0 28px 56px -32px rgba(2,6,23,.35); }
.card-figure{ aspect-ratio: 16/9; object-fit: cover; }

/* Badge chip */
.badge-chip{
  background:#eef2ff; color:var(--c-primary);
  border:1px solid rgba(79,70,229,.18);
  border-radius: 999px; padding:.35rem .6rem; font-weight:600;
}
.badge-soft{ border-radius:999px; padding:.35rem .6rem; font-weight:600; }
.badge-soft.success{ background:#ecfdf5; color:#059669; border:1px solid #a7f3d0; }
.badge-soft.pause{ background:#f1f5f9; color:#475569; border:1px solid #e2e8f0; }

/* Text */
.card-title{ margin:0; font-weight:800; font-size:1.05rem; letter-spacing:.1px; }
.card-desc{ color:var(--c-muted); margin:0; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }

/* Meta */
.meta{ color:var(--c-muted); gap:.75rem; }
.meta i{ opacity:.9; }

/* Buttons */
.btn-pill{ border-radius:14px; }

/* Empty */
.empty{
  border:1px dashed rgba(2,6,23,.12); border-radius:18px; padding:3rem 1rem; background:#fff;
}
</style>

<section class="py-5 mb-4 section-hero">
    <div class="container">
        <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between gap-3">
            <div>
                <h1 class="fw-bold mb-1">
                    Tất cả khảo sát <span class="title-gradient">SurveyWeb</span>
                </h1>
                <p class="text-muted mb-0">Danh sách các khảo sát đang được chia sẻ trên nền tảng.</p>
            </div>
            @if (User?.Identity?.IsAuthenticated ?? false)
            {
                <a asp-area="Admin" asp-controller="Surveys" asp-action="Create" class="btn btn-primary btn-lg btn-pill">
                    <i class="bi bi-plus-circle-dotted me-1"></i>Tạo khảo sát mới
                </a>
            }
        </div>
    </div>
</section>

<section class="container pb-5">
    @if (!(Model?.Any() ?? false))
    {
        <div class="empty text-center text-muted">
            <i class="bi bi-clipboard2-check display-5 d-block mb-3"></i>
            <p class="mb-0">Hiện chưa có khảo sát nào.</p>
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var survey in Model!)
            {
                <div class="col-xl-4 col-md-6">
                    <div class="card card-smooth h-100">
                        @if (!string.IsNullOrWhiteSpace(survey.CoverImagePath))
                        {
                            <img src="@Url.Content("~/" + survey.CoverImagePath)" class="card-img-top card-figure" alt="Ảnh bìa khảo sát @survey.Title" loading="lazy" />
                        }
                        <div class="card-body d-flex flex-column gap-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge-chip">
                                    <i class="bi bi-bookmark-star me-1"></i>@survey.Topic?.Name
                                </span>
                                @if (IsActive(survey))
                                {
                                    <span class="badge-soft success"><i class="bi bi-check2-circle me-1"></i>@StatusText(survey)</span>
                                }
                                else
                                {
                                    <span class="badge-soft pause"><i class="bi bi-pause-circle me-1"></i>@StatusText(survey)</span>
                                }
                            </div>

                            <div>
                                <h3 class="card-title">@survey.Title</h3>
                                @if (!string.IsNullOrWhiteSpace(survey.Description))
                                {
                                    <p class="card-desc">@survey.Description</p>
                                }
                            </div>

                            <div class="mt-auto d-flex justify-content-between align-items-center meta small">
                                <span>
                                    <i class="bi bi-calendar-event me-1"></i>
                                    @(survey.StartAt.HasValue ? survey.StartAt.Value.ToLocalTime().ToString("dd/MM/yyyy") : "Mở liên tục")
                                </span>
                                <span>
                                    <i class="bi bi-people me-1"></i>@(survey.Questions?.Count ?? 0) câu hỏi
                                </span>
                            </div>

                            <div class="d-flex gap-2">
                                <a asp-area="Public" asp-controller="Surveys" asp-action="Details" asp-route-id="@survey.SurveyId" class="btn btn-outline-secondary w-100 btn-pill">
                                    Xem chi tiết
                                </a>
                                <a asp-area="Public" asp-controller="Take" asp-action="Index" asp-route-id="@survey.SurveyId" class="btn btn-primary w-100 btn-pill">
                                    Tham gia
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</section>
